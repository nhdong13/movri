.mobile-listing-order.padding-15
  .row.listing-price
    .col-6.clearfix
      %span.amount.font-open-sans
        - number_price = Money.new(PriceCalculationService.calculate(@listing, ListingViewUtils.get_booking_days(session)), 'USD')
        = MoneyViewUtils.to_humanized(number_price)
        -# = MoneyViewUtils.to_humanized(@listing.price)
      -# - with_quantity_text(@current_community, @listing) do |text|
      -#   %span.time-rent
      -#     \/
      -#     = text
      %span.time-rent.font-open-sans
        \/
        = ListingViewUtils.get_time_rent(session)
    .col-6.clearfix.listing-replacement-value
      %span.font-open-sans
        Replacement Value :
      %span.amount.font-open-sans
        = money_to_humanized(@listing.replacement_cents_fee)
  .row.listing-shipping-date.arrival-date#datepicker{:data => {:locale => I18n.locale, :dateformat => t("datepicker.format")}}
    = form_tag @listing_presenter.form_path, :method => :get, :id => "booking-dates" do
      - if @listing_presenter.quantity_per_day_or_night?
        - @listing_presenter.blocked_dates_result.on_success do |blocked_dates|
          -# Merge manually blocked dates (via admin) with blocked dates automatic (via website booking)
          - if @listing.manually_blocked_dates && @listing.quantity.to_i > 0
            - manually_blocked_dates = ManuallyBlockedDatesService.get_manually_blocked_dates(@listing, 1.day).to_a
            - global_blocked_dates = ManuallyBlockedDatesService.get_global_blocked_dates(@current_community).to_a
            - blocked_dates.concat(manually_blocked_dates)
            - blocked_dates.concat(global_blocked_dates)

          - content_for :extra_javascript do
            :javascript
              window.ST.FromToDatePicker.setupPerDayOrNight(#{raw @listing_presenter.datepicker_per_day_or_night_setup(blocked_dates).to_json});
          .col-6.clearfix.arrival-date
            .form-group
              %label{for: 'arrival-date'} Arrival Date
              %input#arrival-date.form-control.required#start-on{value: session[:booking] ? session[:booking][:start_date] : '', type: "arrival-date", :data => { :output => "booking-start-output" }}
              %input#booking-start-output{:type => 'hidden', :name => 'start_on'}
              = image_tag("mf_icons/icon-movri-calendar.svg", class: 'header-menu-icon icon-movri-calendar')
          .col-6.clearfix.return-date
            .form-group
              %label{for: "return-date"} Return Date
              %input#return-date.form-control.required#end-on{value: session[:booking] ? session[:booking][:end_date] : '',type: "return-date",  :data => { :output => "booking-end-output" }}
              %input#booking-end-output{:type => 'hidden', :name => 'end_on'}
              = image_tag("mf_icons/icon-movri-calendar.svg", class: 'header-menu-icon icon-movri-calendar')
        - @listing_presenter.blocked_dates_result.on_error do
          = t("listings.listing_actions.unable_load_availability")
      .row.listing-order-quantity
        .col-6.row
          .col-5.quantity
            = text_field_tag :number, 1, type: 'number', class: 'order-quantity-number-field', id: 'quantity-number-mobile'
            %i.icon-caret-up#quantity-up-mobile
            %i.icon-caret-down#quantity-down-mobile
          .col-7.add-wish-list
            %button.wish-list-btn
              Wish List
        .col-6.listing-shipping-info
          .clearfix.shipping-rates.flex-items
            %span.mobile-show-shipping-rates-modal{'data-toggle': 'modal', 'data-target': "#mobile-shipping-rates-realtime-modal"}
              Shipping Rates
            %span.mobile-show-pricing-chart-modal{'data-toggle': 'modal', 'data-target': "#mobile-pricing-chart-modal"}
              Pricing Chart

  .row
    .col-12.rent-container
      - if @listing_presenter.quantity_per_day_or_night?
        - @listing_presenter.blocked_dates_result.on_success do
          %button.rent-btn.content.add-item-to-cart{:id => "view-cart-desktop-#{@listing.id}"}
            Rent Now

        - @listing_presenter.blocked_dates_result.on_error do
          %button.disabled-book-button{disabled: true}
            Rent Now

      - else
        %button.disabled-book-button{disabled: true}
          .content
            Rent Now

.padding-15.in-stock
  .in-stock-label
    In Stock

= render partial: "listings/mobile_designs/shipping_rates_realtime", locals: { listing: @listing }
= render partial: "listings/mobile_designs/pricing_chart", locals: { listing: @listing }
= render partial: "listings/mobile_designs/view_cart", locals: { listing: @listing }

- content_for :extra_javascript do
  :javascript
    $('#quantity-up-mobile').on('click', function() {
      var currentVal = parseInt($('input#quantity-number').val()) || 0
      $("input#quantity-number").val(currentVal+1)
    })
    $('#quantity-down-mobile').on('click', function() {
      var currentVal = parseInt($('input#quantity-number').val()) || 1
      if(currentVal !== 0) {
        $('input#quantity-number').val(currentVal-1)
      }
    })
-#     ST.ListingTags.initTagsForEditListing();
-#     ST.BlockedDates.addBlockedDates();
-#     $(document).ready(function(){
-#       $('#end-on').datepicker({
-#         todayHighlight: true,
-#         autoclose: true,
-#         clearBtn: true,
-#         startDate: new Date(),
-#         format: 'mm/dd/yyyy',
-#         daysOfWeekDisabled: [0]
-#       });
-#     });
