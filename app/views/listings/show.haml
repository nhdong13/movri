- content_for :javascript do
  initialize_listing_view('#{I18n.locale}');

- content_for :extra_javascript do
  :javascript
    window.ST.listing();

- content_for :title, raw(@listing.title)
- content_for :meta_author, PersonViewUtils.person_display_name(@listing.author, @current_community)
- content_for :meta_description, StringUtils.first_words(@listing.description, 15)
- content_for :meta_image, @listing.listing_images.first.image.url(:medium) if !@listing.listing_images.empty?
- dimensions = @listing.listing_images.first.get_dimensions_for_style(:medium) if !@listing.listing_images.empty?
- content_for :meta_image_width, dimensions[:width].to_s if !@listing.listing_images.empty?
- content_for :meta_image_height, dimensions[:height].to_s if !@listing.listing_images.empty?

- content_for :title_header do
  %h1
    %span#listing-title.listing-title= @listing.title

%script{type: "text/template", class: "template", id: "image-frame-template"}
  .listing-image-frame
    #listing-image-link.listing-image-frame-content
      .listing-image-vertical-centering{:class => "${aspectRatioClass}" }
        %img{:src => "${url}", :alt => @listing.title, :class => "listing-image ${aspectRatioClass}"}

%script{type: "text/template", class: "template", id: "image-thumbnail-template"}
  .listing-image-thumbnail-container
    %img.listing-image-thumbnail{src: "${url}"}
    .fade

= render partial: 'layouts/onboarding_popup_wrapper'

.row
  .col-12.listing_breadcrumbs
    = render partial: 'listings/listing_breadcrumbs'
  .col-6.listing-details-container
    .row
      .col-12
        = render partial: 'listings/slideshow_images'
    .row
      .col-12
        .col-1
        .col-11.listing-include
          .listing-include-title
            INCLUDES
          .listing-include-items
            %ul
              %li
                Memory Card
              %li
                Camera Bag
              %li
                Battery Pack
              %li
                Speedlite
              %li
                Memory Card
              %li
                Camera Bag
              %li
                Battery Pack
              %li
                Speedlite
    -# .row
    -#   .col-12.listing-description-content
    -#     - if @listing.description && !@listing.description.blank?
    -#       = markdown(@listing.description)
    -#       - if( @listing_presenter.youtube_link_ids.present?)
    -#         - @listing_presenter.youtube_link_ids.each do |youtube_id|
    -#           .listing-description-youtube-wrapper
    -#             %iframe.listing-description-youtube-iframe{ title: t("listings.show.youtube_video_player"), width: 640, height:390, src: "//www.youtube.com/embed/#{ youtube_id }", frameborder: 0, allowfullscreen: true}

    -# - @listing.custom_field_values.each do |custom_field_value|
    -#   .row
    -#     .col-12
    -#       - custom_field_value.with_type do |question_type|
    -#         = render :partial => "listings/custom_field_partials/#{question_type}", :locals => { :custom_field_value => custom_field_value }

    - if @current_community.show_listing_publishing_date?
      .row
        .col-12
          .icon-with-text-container
            = icon_tag("calendar", ["icon-part"])
            .text-part
              %b
                = t(".listing_created_at")
                = l @listing.created_at, :format => :short_date

    -# - if !@current_community.private?
    -#   .row
    -#     .col-12
    -#       .listing-social
    -#         .listing-fb-like-button
    -#           = facebook_like(current_user?(@listing.author))
    -#         .listing-tweet-button
    -#           - twitter_params =  {count: "horizontal", via: (@current_community.twitter_handle), text: @listing.title }.compact
    -#           = link_to("", "https://twitter.com/share", :class => "twitter-share-button", "data" => twitter_params)
    -#           - content_for :extra_javascript do
    -#             :javascript
    -#               !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

    - unless (@listing.closed? && !current_user?(@listing.author)) || !@current_community.listing_comments_in_use
      .view-item
        #comments.discussion.overflow-allowed
          %h2
            = icon_tag("chat_bubble", ["icon-with_text"])
            .text-with-icon
              = t(".comments")
              %span#comment_count= "(#{@listing.comments_count})"
          #follow-links.follow-links
            = render :partial => "follow_links"
          #comment-list
            = render :partial => "comment", :collection => @listing.comments
          #comment-form
            = render :partial => "comment_form"

  %aside.col-6.listing-details
    = render partial: 'listings/listing_orders'
.row
  = render partial: 'listings/recommended_accessories'

.row.listing-specifications
  %ul.nav.nav-pills.listing-categories-detail.clearfix.col-12
    %li.active
      %a.tab-link{'data-tab' => 'spec_tab'} SPECS
    %li
      %a.tab-link{'data-tab' => 'overview_tab'} OVERVIEW
    %li
      %a.tab-link{'data-tab' => 'review_tab'} REVIEWS 4
    %li
      %a.tab-link{'data-tab' => 'qa_tab'} Q&A 6
    %li
      %a.tab-link{'data-tab' => 'compare_tab'} QUICK COMPARE
    %li
      %a.tab-link{'data-tab' => 'accessories_tab'} ACCESSORIES
    %li
      %a.tab-link{'data-tab' => 'compatibility_tab'} COMPATIBILITY

.row
  .listing-specifications.col-9
    = render partial: 'listings/listing_details'

  .include-in-the-box.col-3
    .col-12
      = render partial: 'listings/include_in_the_box'

      .listing-user-manual
        %span.user-manual-file-icon
          = image_tag("mf_icons/icon-movri-file.svg", class: 'header-menu-icon icon-movri-file')
        %span.user-manual-title
          User Manual
        %span.user-manual-file-size
          15.6 MB

      .listing-firmware-updates
        %span.firmware-updates-file-icon
          = image_tag("mf_icons/icon-movri-repair.svg", class: 'header-menu-icon icon-movri-repair')
        %span.firmware-updates-title
          Firmware Updates

.row
  .customers-also-viewed
    = render partial: 'listings/viewed_slide_show', locals: {title: 'Customers Also Viewed', el: 'customer-also-viewed'}

.row
  .browsing-history.col-12
    %button.pull-right.browsing-history-btn-clear
      Clear History
    %button.pull-right.browsing-history-btn-on
      ON
    %span.pull-right
      Browsing History

.row
  .recently_viewed
    = render partial: 'listings/viewed_slide_show', locals: {title: 'Recently Viewed', el: 'recently-viewed'}

- content_for :extra_javascript do
  :javascript
    $(".tab-link").on('click', function(){
      $(".tab-link").parent().removeClass("active");
      $(this).parent().addClass("active");
      $(".tab-content").hide();
      $("#"+$(this).data('tab')).show();
      return false;
    });

    $(document).ready(function() {
      slickInitialize('.customer-also-viewed-slick', '.customer-also-viewed-prev', '.customer-also-viewed-next');
      slickInitialize('.recently-viewed-slick', '.recently-viewed-prev', '.recently-viewed-next');

      function slickInitialize(target, prev, next) {
        $(target).slick({
          dots: true,
          prevArrow: $(prev),
          nextArrow: $(next),
          infinite: false,
          speed: 300,
          slidesToShow: 6,
          slidesToScroll: 6,
          arrows: true,
          responsive: [
            {
              breakpoint: 1024,
              settings: {
                slidesToShow: 3,
                slidesToScroll: 3,
                infinite: true,
                dots: true
              }
            },
            {
              breakpoint: 600,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 480,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1
              }
            }
          ]
        });
      }
    })

    